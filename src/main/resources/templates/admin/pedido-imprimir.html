<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Imprimir Pedido | EcoVivaShop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            .card { box-shadow: none !important; border: 1px solid #ddd !important; }
            body { background: white !important; }
        }
        
        .print-header {
            text-align: center;
            border-bottom: 2px solid #28a745;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .invoice-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .total-section {
            background: #28a745;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container my-4">
        <!-- Botones de acción -->
        <div class="row no-print mb-3">
            <div class="col-12 text-center">
                <button onclick="window.print()" class="btn btn-primary me-2">
                    <i class="bi bi-printer me-2"></i>Imprimir
                </button>
                <a th:href="@{/admin/pedidos}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left me-2"></i>Volver
                </a>
            </div>
        </div>

        <!-- Contenido a imprimir -->
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <!-- Header de la empresa -->
                <div class="print-header">
                    <h1 class="text-success mb-2">
                        <i class="bi bi-leaf-fill me-2"></i>EcoVivaShop
                    </h1>
                    <p class="mb-1">Tienda Ecológica Online</p>
                    <p class="mb-0 text-muted">ventas@ecovivashop.com | +51 999 123 456</p>
                </div>

                <!-- Información del pedido -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="invoice-info">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-receipt me-2"></i>Información del Pedido
                            </h5>
                            <p><strong>Número de Pedido:</strong> <span th:text="${pedido.numeroPedido}">ECO-001</span></p>
                            <p><strong>Fecha:</strong> <span th:text="${#temporals.format(pedido.fechaPedido, 'dd/MM/yyyy HH:mm')}">15/05/2024 14:30</span></p>
                            <p><strong>Estado:</strong> 
                                <span th:class="${pedido.estado == 'PENDIENTE' ? 'badge bg-warning text-dark' : 
                                               (pedido.estado == 'CONFIRMADO' ? 'badge bg-info' :
                                               (pedido.estado == 'PREPARANDO' ? 'badge bg-primary' :
                                               (pedido.estado == 'ENVIADO' ? 'badge bg-secondary' :
                                               (pedido.estado == 'ENTREGADO' ? 'badge bg-success' : 'badge bg-danger'))))}"
                                      th:text="${pedido.estado}">PENDIENTE</span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="invoice-info">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-person me-2"></i>Información del Cliente
                            </h5>
                            <p><strong>Nombre:</strong> <span th:text="${pedido.usuario.nombre + ' ' + pedido.usuario.apellido}">Cliente Ejemplo</span></p>
                            <p><strong>Email:</strong> <span th:text="${pedido.usuario.email}">cliente@ejemplo.com</span></p>
                            <p><strong>Teléfono:</strong> <span th:text="${pedido.usuario.telefono ?: 'No especificado'}">No especificado</span></p>
                        </div>
                    </div>
                </div>

                <!-- Productos del pedido -->
                <div class="mt-4">
                    <h5 class="text-primary mb-3">
                        <i class="bi bi-cart me-2"></i>Productos del Pedido
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-success">
                                <tr>
                                    <th>#</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio Unitario</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="detalle, iterStat : ${pedido.detalles}">
                                    <td th:text="${iterStat.count}">1</td>
                                    <td th:text="${detalle.producto.nombre}">Producto Ejemplo</td>
                                    <td class="text-center" th:text="${detalle.cantidad}">1</td>
                                    <td class="text-end" th:text="'S/ ' + ${#numbers.formatDecimal(detalle.precioUnitario, 1, 2)}">S/ 100.00</td>
                                    <td class="text-end fw-bold" th:text="'S/ ' + ${#numbers.formatDecimal(detalle.subtotal, 1, 2)}">S/ 100.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Total -->
                <div class="row mt-4">
                    <div class="col-md-6 offset-md-6">
                        <div class="total-section">
                            <h4 class="mb-2">
                                <i class="bi bi-currency-dollar me-2"></i>Total del Pedido
                            </h4>
                            <h2 class="mb-0 fw-bold" th:text="'S/ ' + ${#numbers.formatDecimal(pedido.total, 1, 2)}">S/ 300.50</h2>
                        </div>
                    </div>
                </div>

                <!-- Información adicional -->
                <div class="mt-4 pt-4 border-top">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="text-muted">Términos y Condiciones:</h6>
                            <small class="text-muted">
                                • Los productos se entregan en un plazo de 3-5 días hábiles.<br>
                                • Para cambios o devoluciones, contacte dentro de 7 días.<br>
                                • Este documento es un comprobante de la transacción realizada.
                            </small>
                        </div>
                        <div class="col-md-4 text-end">
                            <p class="mb-0"><strong>Fecha de Impresión:</strong></p>
                            <small class="text-muted" th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}">15/05/2024 14:30</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-imprimir si se accede con parámetro print=true
        if (window.location.search.includes('print=true')) {
            window.onload = function() {
                window.print();
            };
        }
    </script>
</body>
</html>
